(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/info_1/info_1"],{"16bd":function(t,e,s){"use strict";s.r(e);var a=s("5267"),i=s("449e");for(var n in i)"default"!==n&&function(t){s.d(e,t,function(){return i[t]})}(n);s("347c");var r=s("2877"),c=Object(r["a"])(i["default"],a["a"],a["b"],!1,null,"3ff5074c",null);e["default"]=c.exports},1861:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a={data:function(){return{like:!0,number:40,msgs:[{title:"SQL优化还能凭经验？这个工具能帮你智能优化SQL",number:1637,cover:"../../static/picture-1-1.jpg"},{title:"很火的Java题--判断一个整数是否是奇数",number:574,cover:"../../static/picture-1-1.jpg"},{title:"Vue实现一个图片懒加载插件",number:413,cover:"../../static/picture-1-1.jpg"}]}},onLoad:function(){},onShow:function(){},methods:{iflike:function(t){this.like=!this.like,this.number+=t},notlike:function(t){this.like=!this.like,this.number-=t}}};e.default=a},"347c":function(t,e,s){"use strict";var a=s("fd25"),i=s.n(a);i.a},"449e":function(t,e,s){"use strict";s.r(e);var a=s("1861"),i=s.n(a);for(var n in a)"default"!==n&&function(t){s.d(e,t,function(){return a[t]})}(n);e["default"]=i.a},5267:function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("view",{staticClass:"content"},[s("view",{staticClass:"msg-header"},[t._m(0),t._m(1),t._m(2),t._m(3),t._m(4),s("view",{staticClass:"msg-bottom"},[s("view",{staticClass:"bottom-left"},[t.like?s("view",[s("image",{staticClass:"like",attrs:{src:"../../static/like.png",eventid:"94db03a4-0"},on:{tap:function(e){t.iflike(1)}}}),s("text",{staticStyle:{"margin-left":"15rpx"}},[t._v(t._s(t.number))])]):t._e(),t.like?t._e():s("view",[s("image",{staticClass:"like",attrs:{src:"../../static/select-like.png",eventid:"94db03a4-1"},on:{tap:function(e){t.notlike(1)}}}),s("text",{staticStyle:{"margin-left":"15rpx"}},[t._v(t._s(t.number))])])]),t._m(5)])]),s("view",{staticClass:"gift"},[s("text",{staticClass:"gift-title"},[t._v("小礼物走一走,来简书关注我")]),s("button",{staticClass:"gift-btn"},[t._v("赞赏支持")])],1),s("view",{staticClass:"msg-recommand"},[s("text",{staticClass:"recommand"},[t._v("相关推荐")]),t._l(t.msgs,function(e,a){return s("view",{key:a,staticClass:"msg2"},[s("view",{staticClass:"msg-recommand-left"},[s("text",{staticClass:"msgs-title"},[t._v(t._s(e.title))]),s("text",{staticClass:"read-number"},[t._v("阅读  "+t._s(e.number))])]),s("view",{staticClass:"msg-recommand-right"},[s("image",{attrs:{src:e.cover}})])])})],2),s("hr"),s("view",{staticClass:"comment"},[t._m(6),s("view",{staticClass:"comment-content"},[s("image",{staticStyle:{width:"50%",height:"150rpx"},attrs:{src:"../../static/icon-comments.png"}}),s("view",{staticClass:"null-comment",staticStyle:{width:"85%",display:"flex","align-items":"center","justify-content":"center","margin-top":"20rpx"}},[t._v("智慧如你,不想"),s("navigator",{staticClass:"release"},[t._v("发表一点看法")]),t._v("咩~")],1)]),t._m(7),s("view",{staticClass:"bottom-bar"},[s("view",{staticClass:"bottom-bar-1"},[t._m(8),t._m(9),s("view",{staticClass:"praise"},[t.like?s("image",{staticClass:"img",attrs:{src:"../../static/like.png",eventid:"94db03a4-2"},on:{tap:function(e){t.iflike(1)}}}):t._e(),t.like?t._e():s("image",{staticClass:"img",attrs:{src:"../../static/select-like.png",eventid:"94db03a4-3"},on:{tap:function(e){t.notlike(1)}}}),s("text",{staticClass:"bar-info"},[t._v("喜欢 "+t._s(t.number))])]),t._m(10)])])])],1)},i=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("view",{staticClass:"title"},[s("text",[t._v("深入理解Mybatis插件开发")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("view",{staticClass:"user-info"},[s("view",{staticClass:"user-info-left"},[s("image",{staticClass:"avatar",attrs:{src:"../../static/104.jpg"}}),s("text",{staticClass:"nickname"},[t._v("java高并发")])]),s("view",{staticClass:"followed"},[s("text",{staticClass:"followed"},[t._v("+ 关注")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("view",{staticClass:"msg-info"},[s("text",{staticClass:"left"},[t._v("字数  2476·阅读 514")]),s("text",{staticClass:"left"},[t._v("2019-03-09   15:13")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("view",{staticClass:"text-content"},[s("view",{staticClass:"msg"},[s("text",{staticClass:"title1"},[t._v("阅读目录")]),t._v("\\n\t\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\n1.背景\n2.Mybatis插件典型适用场景\n3.Mybatis插件介绍\n4.Mybatis插件实现机制\n5.Mybatis插件开发例子\n6.小结\n\\n\\n"),s("text",{staticClass:"title1"},[t._v("背景")]),t._v("\\n\\n\n关于Mybatis插件，大部分人都知道，也都使用过，但很多时候，我们仅仅是停留在表面上，知道Mybatis插件可以在DAO层进行拦截，如打印执行的SQL语句日志，做一些权限控制，分页等功能；但对其内部实现机制，涉及的软件设计模式，编程思想往往没有深入的理解。\n\n本篇案例将帮助读者对Mybatis插件的使用场景，实现机制，以及其中涉及的编程思想进行一个小结，希望对以后的编程开发工作有所帮助。\n\n注：本案例以mybatis 3.4.7-SNAPSHOT版本为例。\n\nPS：文章是挺久之前写的，当时花了一些心思，存到电脑的word里，今天正好看到，就是里面的源码都是图片，哈哈哈，凑合着看吧。\n\\n\\n"),s("text",{staticClass:"title1"},[t._v("Mybatis插件典型适用场景")]),t._v("\\n\\n\n分页功能\n\nmybatis的分页默认是基于内存分页的（查出所有，再截取），数据量大的情况下效率较低，不过使用mybatis插件可以改变该行为，只需要拦截StatementHandler类的prepare方法，改变要执行的SQL语句为分页语句即可；\n\n公共字段统一赋值\n\n一般业务系统都会有创建者，创建时间，修改者，修改时间四个字段，对于这四个字段的赋值，实际上可以在DAO层统一拦截处理，可以用mybatis插件拦截Executor类的update方法，对相关参数进行统一赋值即可；\n\n性能监控\n\n对于SQL语句执行的性能监控，可以通过拦截Executor类的update, query等方法，用日志记录每个方法执行的时间；\n\n其它\n\n其实mybatis扩展性还是很强的，基于插件机制，基本上可以控制SQL执行的各个阶段，如执行阶段，参数处理阶段，语法构建阶段，结果集处理阶段，具体可以根据项目业务来实现对应业务逻辑。\n\\n\\n"),s("text",{staticClass:"title1"},[t._v("Mybatis插件介绍")]),t._v("\\n\\n\n什么是Mybatis插件\\n\n\n与其称为Mybatis插件，不如叫Mybatis拦截器，更加符合其功能定位，实际上它就是一个拦截器，应用代理模式，在方法级别上进行拦截。\n\n支持拦截的方法\\n\n\n执行器Executor（update、query、commit、rollback等方法）；\n参数处理器ParameterHandler（getParameterObject、setParameters方法）；\n结果集处理器ResultSetHandler（handleResultSets、handleOutputParameters等方法）；\nSQL语法构建器StatementHandler（prepare、parameterize、batch、update、query等方法）；\n拦截阶段\\n\n\n那么这些类上的方法都是在什么阶段被拦截的呢？为理解这个问题，我们先看段简单的代码（摘自mybatis源码中的单元测试SqlSessionTest类），来了解下典型的mybatis执行流程，如下代码所示：\n\n\n以上代码主要完成以下功能：\\n\n\n读取mybatis的xml配置文件信息\n通过SqlSessionFactoryBuilder创建SqlSessionFactory对象\n通过SqlSessionFactory获取SqlSession对象\n执行SqlSession对象的selectList方法，查询结果\n关闭SqlSession\n如下是时序图，在整个时序图中，涉及到mybatis插件部分已标红，基本上就是体现在上文中提到的四个类上，对这些类上的方法进行拦截。"),s("image",{staticStyle:{"margin-top":"40rpx","margin-bottom":"40rpx",width:"100%",height:"80rpx"},attrs:{src:"../../static/img1.jpg"}}),t._v("\\n\\n"),s("text",{staticClass:"title1"},[t._v("Mybatis插件实现机制")]),t._v("\\n\\n\n插件配置信息的加载\n\n先来看下mybatis是如何加载插件配置的，对应的xml配置信息如下："),s("image",{staticStyle:{"margin-top":"40rpx","margin-bottom":"40rpx",width:"100%",height:"180rpx"},attrs:{src:"../../static/img2.jpg"}}),t._v("对应的解析代码如下，主要做以下工作：\n\n根据解析到的类信息创建Interceptor对象；\n调用setProperties方法设置属性变量；\n添加到Configuration的interceptorChain拦截器链中；"),s("image",{staticStyle:{"margin-top":"40rpx","margin-bottom":"40rpx",width:"100%",height:"120rpx"},attrs:{src:"../../static/img3.jpg"}}),t._v("以上逻辑对应的时序图如下：\n\n\n代理对象的生成\n\nMybatis插件的实现机制主要是基于动态代理实现的，其中最为关键的就是代理对象的生成，所以有必要来了解下这些代理对象是如何生成的。\n\nExecutor代理对象\n\nParameterHandler代理对象\n\nResultSetHandler代理对象"),s("image",{staticStyle:{"margin-top":"40rpx","margin-bottom":"40rpx",width:"100%",height:"50rpx"},attrs:{src:"../../static/img6.jpg"}}),t._v("StatementHandler代理对象\n\n观察源码，发现这些可拦截的类对应的对象生成都是通过InterceptorChain的pluginAll方法来创建的，进一步观察pluginAll方法，如下：\n\n遍历所有拦截器，调用拦截器的plugin方法生成代理对象，注意生成代理对象重新赋值给target，所以如果有多个拦截器的话，生成的代理对象会被另一个代理对象代理，从而形成一个代理链条，执行的时候，依次执行所有拦截器的拦截逻辑代码；\n\n接下来看一下我们在编写拦截器的时候，一个典型的plugin方法实现方式，如下：\n\n再进一步查看wrap方法，如下：\n\n典型的动态代理实现，调用的是Proxy.newProxyInstance方法来生成代理对象。\n\n以上逻辑对应的时序图如下，这里我们假设声明了两个拦截器，那么在创建target代理对象的时候，最终返回的代理对象proxy2，实际上代理了proxy1，而proxy1又代理了target，：\n\n拦截逻辑的执行\n\n由于真正去执行Executor、ParameterHandler、ResultSetHandler和StatementHandler类中的方法的对象是代理对象（建议将代理对象转为class文件，反编译查看其结构，帮助理解），所以在执行方法时，首先调用的是Plugin类（实现了InvocationHandler接口）的invoke方法，如下：\n\n首先根据执行方法所属类获取拦截器中声明需要拦截的方法集合；\n\n判断当前方法需不需要执行拦截逻辑，需要的话，执行拦截逻辑方法（即Interceptor接口的intercept方法实现），不需要则直接执行原方法。\n\n可以关注下Interceptor接口的intercept方法实现，一般需要用户自定义实现逻辑，其中有一个重要参数，即Invocation类，通过改参数我们可以获取执行对象，执行方法，以及执行方法上的参数，从而进行各种业务逻辑实现，一般在该方法的最后一句代码都是invocation.proceed()（内部执行method.invoke方法），否则将无法执行下一个拦截器的intercept方法。\n\n以上逻辑对应的时序图如下，这里我们以执行executor对象的query方法为例，且假设有两个拦截器存在：")]),s("image",{staticStyle:{"margin-top":"20rpx","margin-bottom":"20rpx",width:"100%",height:"220rpx"},attrs:{src:"../../static/img7.jpg"}})])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("view",{staticClass:"btn-box"},[s("view",{staticClass:"btn"},[t._v("...")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("view",{staticClass:"bottom-left"},[s("image",{staticStyle:{"margin-right":"30rpx"},attrs:{src:"../../static/wx.png"}}),s("image",{staticStyle:{"margin-right":"30rpx"},attrs:{src:"../../static/朋友圈.png"}}),s("text",{staticClass:"more"},[t._v("···")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("view",{staticClass:"comment-header"},[s("view",{staticClass:"comment-header-left",staticStyle:{"margin-left":"40rpx"}},[s("text",{staticClass:"comment-number"},[t._v("评论(0)")]),s("view",{staticClass:"condition",staticStyle:{"margin-left":"20rpx","margin-top":"45rpx"}},[t._v("只看作者")])]),s("view",{staticClass:"comment-header-right",staticStyle:{"margin-right":"40rpx"}},[s("text",{staticClass:"comment-number "},[t._v("按时间倒序")])])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("view",{staticClass:"write-comment"},[s("view",{staticClass:"write-comment-1"},[s("image",{attrs:{src:"../../static/write.png"}}),s("input",{staticClass:"writemsg",attrs:{type:"text",placeholder:"写下你的评论..."}})])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("view",{staticClass:"praise"},[s("image",{staticClass:"img",attrs:{src:"../../static/赞赏收益.png"}}),s("text",{staticClass:"bar-info"},[t._v("赞赏")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("view",{staticClass:"praise"},[s("image",{staticClass:"img",attrs:{src:"../../static/comment-8a.png"}}),s("text",{staticClass:"bar-info"},[t._v("评论 0")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("view",{staticClass:"praise"},[s("image",{staticClass:"img",attrs:{src:"../../static/share.png"}}),s("text",{staticClass:"bar-info"},[t._v("分享")])])}];s.d(e,"a",function(){return a}),s.d(e,"b",function(){return i})},f1a5:function(t,e,s){"use strict";s("9a07");var a=n(s("b0ce")),i=n(s("16bd"));function n(t){return t&&t.__esModule?t:{default:t}}Page((0,a.default)(i.default))},fd25:function(t,e,s){}},[["f1a5","common/runtime","common/vendor"]]]);